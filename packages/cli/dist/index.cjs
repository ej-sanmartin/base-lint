#!/usr/bin/env node
"use strict";var Ue=Object.create;var Q=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var Ge=Object.getPrototypeOf,ze=Object.prototype.hasOwnProperty;var Ve=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Me(t))!ze.call(e,i)&&i!==r&&Q(e,i,{get:()=>t[i],enumerable:!(n=qe(t,i))||n.enumerable});return e};var g=(e,t,r)=>(r=e!=null?Ue(Ge(e)):{},Ve(t||!e||!e.__esModule?Q(r,"default",{value:e,enumerable:!0}):r,e));var He=require("commander");var S=g(require("path"),1),ke=require("globby"),Re=require("minimatch");var ge=require("fs"),M=g(require("path"),1);var Z=require("@typescript-eslint/typescript-estree");function B(e,t){try{return(0,Z.parse)(e,{loc:!0,range:!0,jsx:t.endsWith("x"),comment:!1,errorOnUnknownASTType:!1,useJSXTextNode:!0})}catch{return null}}function T(e,t,r=null){t(e,r);for(let n of Object.keys(e)){let i=e[n];if(i)if(Array.isArray(i))for(let s of i)s&&typeof s=="object"&&"type"in s&&T(s,t,e);else typeof i=="object"&&"type"in i&&T(i,t,e)}}var ee=g(require("postcss"),1);function O(e,t){try{return ee.default.parse(e,{from:t})}catch{return null}}function te(e,t){e.walk(r=>{(r.type==="rule"||r.type==="atrule")&&t(r)})}var I=require("node-html-parser");function ie(e){let t=(0,I.parse)(e,{script:!0,style:!0,comment:!1}),r=[],n=t.querySelectorAll("script, style");for(let i of n)if(i instanceof I.HTMLElement){if(i.tagName==="SCRIPT"){if(i.getAttribute("src"))continue;let o=i.innerHTML;r.push({type:"script",content:o,line:ne(e,re(i))})}else if(i.tagName==="STYLE"){let s=i.innerHTML;r.push({type:"style",content:s,line:ne(e,re(i))})}}return r}function ne(e,t){return t<=0?1:e.slice(0,t).split(/\r?\n/).length}function re(e){if(Array.isArray(e.range)&&e.range.length>0)return e.range[0];let t=e.toString(),r=e.root;return r?r.toString().indexOf(t):0}function D(e,t){let r=[];return T(e,(n,i)=>{if(n.type==="MemberExpression"){let s=We(n,t);s&&r.push(s)}else if(n.type==="NewExpression"){let s=Ke(n);s&&r.push(s)}else if(n.type==="Identifier"){let s=Ye(n,i);s&&r.push(s)}}),r}function j(e){let t=[];return te(e,r=>{if(r.type==="rule"){let n=r.selector??"";n.includes(":has(")&&t.push(L("css.has-selector",":has() selector",r)),n.includes(":where(")&&t.push(L("css.where-selector",":where() selector",r))}r.type==="atrule"&&r.name==="container"&&t.push(L("css.container-queries","@container queries",r))}),t}function We(e,t){if(!t.strict&&e.computed)return null;let r=se(e.object),n=e.property&&e.property.type==="Identifier"?e.property.name:null;return!r||!n?null:{"navigator.share":{featureId:"web.share",featureName:"Web Share API",line:e.property.loc?.start.line??e.loc?.start.line??null,column:(e.property.loc?.start.column??e.loc?.start.column??0)+1},"navigator.usb":{featureId:"web.usb",featureName:"WebUSB API",line:e.property.loc?.start.line??e.loc?.start.line??null,column:(e.property.loc?.start.column??e.loc?.start.column??0)+1},"Notification.requestPermission":{featureId:"web.notifications",featureName:"Notifications API",line:e.property.loc?.start.line??e.loc?.start.line??null,column:(e.property.loc?.start.column??e.loc?.start.column??0)+1}}[`${r}.${n}`]??null}function Ke(e){if(e.callee.type==="Identifier"){let t=e.callee.name;if(t==="Notification")return{featureId:"web.notifications",featureName:"Notifications API",line:e.callee.loc?.start.line??e.loc?.start.line??null,column:(e.callee.loc?.start.column??e.loc?.start.column??0)+1};if(t==="BroadcastChannel")return{featureId:"web.broadcast-channel",featureName:"BroadcastChannel API",line:e.callee.loc?.start.line??e.loc?.start.line??null,column:(e.callee.loc?.start.column??e.loc?.start.column??0)+1};if(t==="IdleDetector")return{featureId:"web.idle-detection",featureName:"Idle Detection API",line:e.callee.loc?.start.line??e.loc?.start.line??null,column:(e.callee.loc?.start.column??e.loc?.start.column??0)+1}}return null}function Ye(e,t){return e.name==="IdleDetector"?t&&t.type==="NewExpression"&&t.callee===e?null:{featureId:"web.idle-detection",featureName:"Idle Detection API",line:e.loc?.start.line??null,column:(e.loc?.start.column??0)+1}:null}function L(e,t,r){let n=r.source?.start;return{featureId:e,featureName:t,line:n?.line??null,column:n?n.column+1:null}}function se(e){if(e.type==="Identifier")return e.name;if(e.type==="MemberExpression"&&e.property.type==="Identifier"&&!e.computed){let t=se(e.object);if(t)return`${t}.${e.property.name}`}return null}var oe=require("fs"),ae=require("module"),$=g(require("path"),1),J=require("url"),H={},Xe=typeof H<"u"&&H.url?H.url:typeof __filename<"u"?(0,J.pathToFileURL)(__filename).href:(0,J.pathToFileURL)($.default.join(process.cwd(),"index.js")).href,ce=(0,ae.createRequire)(Xe),Qe=ce("web-features/data.json"),U="unknown";try{let e=ce.resolve("web-features"),t=$.default.join($.default.dirname(e),"package.json"),r=(0,oe.readFileSync)(t,"utf-8"),n=JSON.parse(r);typeof n.version=="string"&&(U=n.version)}catch{U="unknown"}var le=new Map,Ze=Qe.features??{};for(let[e,t]of Object.entries(Ze))le.set(e,{id:e,name:t.name??e,status:{baseline:t.status?.baseline??null},compat_features:t.compat_features??[]});function ue(){return U}function me(e){let t=le.get(e);return t?{level:et(t.status?.baseline),featureName:t.name??e,compatKeys:t.compat_features??[]}:{level:"widely",featureName:e,compatKeys:[]}}function pe(e){switch(e){case"limited":return"Provide fallback UI or feature detection for unsupported browsers.";case"newly":return"OK for modern targets; keep a fallback in place for older browsers.";default:return"No action required."}}function et(e){return e===!1?"limited":e==="low"?"newly":"widely"}var k=g(require("picocolors"),1);function q(e,t){let n=`${e==="info"?k.default.blue("[base-lint]"):e==="warn"?k.default.yellow("[base-lint]"):k.default.red("[base-lint]")} ${t}`;e==="error"?console.error(n):e==="warn"?console.warn(n):console.log(n)}var a={info:e=>q("info",e),warn:e=>q("warn",e),error:e=>q("error",e)};async function ye(e){let{cwd:t,files:r,strict:n,suppress:i,treatNewlyAs:s,cliVersion:o}=e,l=ue(),c=[];for(let m of r){let f=M.default.resolve(t,m),w;try{w=await ge.promises.readFile(f,"utf8")}catch(y){a.warn(`Unable to read ${m}: ${y.message}`);continue}let d=M.default.extname(m).toLowerCase();if([".js",".jsx",".ts",".tsx",".mjs",".cjs"].includes(d)){let y=tt(w,m,{strict:n});de(c,y,i);continue}if(d===".css"||d===".scss"){let y=nt(w,m);de(c,y,i);continue}if(d===".html"||d===".htm"){let y=await rt(w,m,n,i);c.push(...y);continue}}return c.sort((m,f)=>m.file.localeCompare(f.file)||(m.line??0)-(f.line??0)),{summary:it(c),findings:c,meta:{cliVersion:o,datasetVersion:l,strict:n,treatNewlyAs:s,generatedAt:new Date().toISOString()}}}function tt(e,t,r){let n=B(e,t);return n?D(n,{strict:r.strict}).map(s=>R(t,s)):(a.warn(`Unable to parse JavaScript in ${t}`),[])}function nt(e,t){let r=O(e,t);return r?j(r).map(i=>R(t,i)):(a.warn(`Unable to parse CSS in ${t}`),[])}async function rt(e,t,r,n){let i=ie(e),s=[];for(let o of i)if(o.type==="script"){let l=B(o.content,`${t}#inline-script`);if(!l){a.warn(`Unable to parse inline script in ${t}`);continue}let c=D(l,{strict:r});for(let u of c){let p=fe(u,o.line),m=R(t,p);n.includes(m.featureId)||s.push(m)}}else if(o.type==="style"){let l=O(o.content,`${t}#inline-style`);if(!l){a.warn(`Unable to parse inline style in ${t}`);continue}let c=j(l);for(let u of c){let p=fe(u,o.line),m=R(t,p);n.includes(m.featureId)||s.push(m)}}return s}function fe(e,t){return{...e,line:e.line!=null?e.line+t-1:t}}function de(e,t,r){for(let n of t)r.includes(n.featureId)||e.push(n)}function R(e,t){let r=me(t.featureId),n=pe(r.level);return{file:e,line:t.line??null,column:t.column??null,featureId:t.featureId,featureName:r.featureName||t.featureName,baseline:r.level,guidance:n,ruleId:`baseline/${r.level}`}}function it(e){let t={total:e.length,limited:0,newly:0,widely:0};for(let r of e)r.baseline==="limited"?t.limited+=1:r.baseline==="newly"?t.newly+=1:t.widely+=1;return t}function we(e){return JSON.stringify(e,null,2)}function he(e){let t=[];t.push("<!-- base-lint-sticky -->"),t.push("## Base Lint Report"),t.push("");let r=`**Status:** ${st(e.summary)}`;if(t.push(r),t.push(""),t.push("| File | Line | Feature | Baseline | Guidance |"),t.push("|------|------|---------|----------|----------|"),e.findings.length===0)t.push("| (none) | - | - | - | Baseline clear |");else for(let n of e.findings){let i=n.line!=null?String(n.line):"-",s=be(n.featureName),o=be(n.guidance);t.push(`| ${n.file} | ${i} | ${s} | ${at(n.baseline)} | ${o} |`)}return t.push(""),t.push(`Policy: Limited = error (max 0), Newly = ${ot(e.meta.treatNewlyAs)}`),t.push(`Dataset: web-features ${e.meta.datasetVersion}`),t.join(`
`)}function st(e){return[`\u274C Limited: ${e.limited}`,`\u26A0\uFE0F Newly: ${e.newly}`,`\u2705 Widely: ${e.widely}`].join(" \xB7 ")}function ot(e){switch(e){case"error":return"error";case"ignore":return"ignored";default:return"warn (non-blocking)"}}function be(e){return e.replace(/\|/g,"\\|")}function at(e){return e.charAt(0).toUpperCase()+e.slice(1)}var v=require("fs"),Ne=g(require("path"),1);async function G(e){await v.promises.mkdir(e,{recursive:!0})}async function F(e,t){await G(Ne.default.dirname(e)),await v.promises.writeFile(e,t,"utf8")}async function Se(e,t){await F(e,JSON.stringify(t,null,2))}async function A(e){let t=await v.promises.readFile(e,"utf8");return JSON.parse(t)}async function P(e){try{return await v.promises.readFile(e,"utf8")}catch(t){if(t.code==="ENOENT")return null;throw t}}var C=g(require("path"),1),xe=require("fs");var ct={mode:"diff",treatNewlyAs:"warn",maxLimited:0,strict:!1,targets:"all",suppress:[],include:[],ignore:[]},lt=["node_modules/","dist/","build/","coverage/","*.min.js"];async function ve(e,t){let r=t.config?C.default.resolve(e,t.config):C.default.join(e,"base-lint.config.json"),n=await ut(r);if(t.config&&!n)throw new Error(`Config file not found at ${r}`);let i={...ct,...n??{}};if(t.mode){if(!["diff","repo"].includes(t.mode))throw new Error(`Unsupported mode: ${t.mode}`);i.mode=t.mode}if(typeof t.strict=="boolean"&&(i.strict=t.strict),t.treatNewly){if(!["warn","error","ignore"].includes(t.treatNewly))throw new Error(`Unsupported treat-newly option: ${t.treatNewly}`);i.treatNewlyAs=t.treatNewly}i.maxLimited=Number(n?.maxLimited??i.maxLimited),Number.isNaN(i.maxLimited)&&(i.maxLimited=0);let s=Array.isArray(i.suppress)?i.suppress:[],o=Array.isArray(n?.ignore)?n.ignore??[]:[],l=Array.isArray(n?.include)?n.include??[]:[],c=await mt(e),u=[...lt,...o,...c],p=Array.from(new Set(u.filter(Boolean))),m=l;return{config:{...i,suppress:s,ignore:p,include:m},ignorePatterns:p,includePatterns:m,configPath:n?r:void 0}}async function ut(e){try{let t=await xe.promises.readFile(e,"utf8");return JSON.parse(t)}catch(t){if(t.code==="ENOENT")return null;throw t}}async function mt(e){let t=await P(C.default.join(e,".base-lintignore"));return t?t.split(/\r?\n/).map(r=>r.trim()).filter(r=>r.length>0&&!r.startsWith("#")):[]}var Ae=require("util"),Ee=require("child_process"),Te=g(require("path"),1);var pt=(0,Ae.promisify)(Ee.exec);async function Ie(e){let t=(await N(["rev-parse","HEAD"],e)).trim(),r=process.env.GITHUB_BASE_REF,n=process.env.GITHUB_SHA,i=await dt(),s=null;if(i&&n)s=`${i}...${n}`;else if(r)s=`origin/${r}...${t}`;else{let c=await ft(e).catch(()=>null);c&&(s=`${c}...${t}`)}let o;s?o=["diff","--name-only","--diff-filter=ACMRTUB",s]:o=["diff","--name-only","--diff-filter=ACMRTUB","HEAD"];let l;try{l=await N(o,e)}catch{l=await N(["diff","--name-only","--diff-filter=ACMRTUB","HEAD"],e)}return l.split(/\r?\n/).map(c=>c.trim()).filter(Boolean)}async function N(e,t){let r=`git ${e.join(" ")}`,{stdout:n}=await pt(r,{cwd:t});return n}async function ft(e){try{let n=(await N(["merge-base","HEAD","origin/HEAD"],e)).trim();if(n)return n}catch{}let t=["main","master"];for(let n of t)try{let i=(await N(["merge-base","HEAD",n],e)).trim();if(i)return i}catch{}return(await N(["rev-parse","HEAD^"],e)).trim()}async function dt(){let e=process.env.GITHUB_EVENT_PATH;if(!e)return null;try{let t=await P(Te.default.resolve(e));if(!t)return null;let r=JSON.parse(t),n=r?.pull_request?.base?.sha??r?.merge_group?.base_sha;return typeof n=="string"?n:null}catch{return null}}var $e={name:"base-lint",version:"0.1.0",description:"Lint your repo against Web Baseline policies",license:"MIT",type:"module",bin:{"base-lint":"./dist/index.js"},files:["dist"],imports:{vitest:"../../tests/mocks/vitest.js"},scripts:{build:"tsup --config tsup.config.ts",dev:"tsx src/index.ts --help",prepublishOnly:"npm run build"},dependencies:{"@typescript-eslint/typescript-estree":"^6.21.0",commander:"^11.1.0",globby:"^13.2.2",ignore:"^5.3.1",minimatch:"^9.0.3","node-html-parser":"^6.1.11",picocolors:"^1.0.0",postcss:"^8.4.35","web-features":"^2.0.0"},devDependencies:{"@types/node":"^20.11.30",tsup:"^8.0.1",tsx:"^4.7.1",typescript:"^5.4.2"}};var yt=[".js",".jsx",".ts",".tsx",".mjs",".cjs",".css",".scss",".html",".htm"];async function Fe(e){let t=process.cwd(),r=S.default.resolve(t,e.out??".base-lint-report"),n=await ve(t,e),i=n.config,s=await wt(t,i.mode,n.includePatterns,n.ignorePatterns);s.length===0?a.warn("No files matched the scan configuration."):a.info(`Scanning ${s.length} file(s) in ${i.mode} mode.`);let o=await ye({cwd:t,files:s,strict:i.strict,suppress:i.suppress??[],treatNewlyAs:i.treatNewlyAs,cliVersion:$e.version??"0.0.0"});await G(r),await F(S.default.join(r,"report.json"),we(o)),await F(S.default.join(r,"report.md"),he(o)),await Se(S.default.join(r,"meta.json"),{cliVersion:o.meta.cliVersion,datasetVersion:o.meta.datasetVersion,generatedAt:o.meta.generatedAt,config:{path:n.configPath??null,mode:i.mode,strict:i.strict,treatNewlyAs:i.treatNewlyAs,maxLimited:i.maxLimited,suppress:i.suppress,include:i.include,ignore:i.ignore},filesAnalyzed:s}),a.info(`Report written to ${r}`)}async function wt(e,t,r,n){let i=bt(n),s=n();s.add(i);let o=r.map(u=>Re.minimatch.filter(u,{dot:!0,matchBase:!0})),l=u=>!(!yt.includes(S.default.extname(u).toLowerCase())||s.ignores(u)||o.length>0&&!o.some(p=>p(u)));if(t==="repo"){let u=r.length>0?r:["**/*"],p=await(0,ke.globby)(u,{cwd:e,gitignore:!0,dot:!0,ignore:i,onlyFiles:!0});return Array.from(new Set(p.filter(m=>l(m))))}let c=await Ie(e);return Array.from(new Set(c.filter(u=>l(u))))}function bt(e){let t=[];for(let r of e)t.push(r),r.endsWith("/")&&t.push(`${r}**`);return t}var Pe=g(require("path"),1);async function Ce(e){let t=process.cwd(),r=Pe.default.resolve(t,e.input),n=await A(r),i=Number(e.maxLimited??0),s=n.summary.limited,o=n.summary.newly,l=e.failOnWarn??n.meta.treatNewlyAs==="error";if(a.info(`Report summary \u2013 Limited: ${s}, Newly: ${o}, Widely: ${n.summary.widely}`),Number.isNaN(i))throw new Error("Invalid max-limited value.");if(s>i){a.error(`Limited findings (${s}) exceed the allowed maximum (${i}).`),process.exitCode=1;return}if(l&&o>0){a.error(`Newly findings (${o}) present and fail-on-warn is enabled.`),process.exitCode=1;return}a.info("Baseline policy satisfied.")}var z=require("fs"),_e=g(require("path"),1);async function Be(e){let t=process.cwd(),r=e.stickyMarker??"<!-- base-lint-sticky -->",n=_e.default.resolve(t,e.input),i=await z.promises.readFile(n,"utf8"),s=process.env.GITHUB_TOKEN||process.env.GH_TOKEN,o=process.env.GITHUB_REPOSITORY,l=process.env.GITHUB_EVENT_NAME;if(!s||!o||!l){a.info("GitHub context not detected. Skipping sticky comment.");return}if(!l.startsWith("pull_request")){a.info(`Event ${l} is not a pull request. Skipping comment.`);return}let c=await ht();if(!c){a.info("No pull request number found in event payload. Skipping comment.");return}if(c.isFork){a.info("Pull request originates from a fork. Skipping sticky comment to avoid permission issues.");return}let[u,p]=o.split("/"),f=(await Nt(u,p,c.number,s)).find(d=>d.body?.includes(r));if(f){await xt(u,p,f.id,i,s)&&a.info(`Updated existing sticky comment #${f.id}.`);return}await St(u,p,c.number,i,s)&&a.info(`Created sticky comment on PR #${c.number}.`)}async function ht(){let e=process.env.GITHUB_EVENT_PATH;if(!e)return null;try{let t=await z.promises.readFile(e,"utf8"),r=JSON.parse(t),n=r?.pull_request?.number??r?.number;if(typeof n!="number")return null;let i=r?.pull_request?.base?.repo?.full_name,s=r?.pull_request?.head?.repo?.full_name;return{number:n,isFork:!!(s&&i&&s!==i)}}catch(t){return a.warn(`Failed to parse GitHub event payload: ${t.message}`),null}}async function Nt(e,t,r,n){let i=`https://api.github.com/repos/${e}/${t}/issues/${r}/comments?per_page=100`,s=await V(i,n);if(!s.ok){if(s.status===403||s.status===404)return a.warn(`Insufficient permissions to list comments (status ${s.status}).`),[];throw new Error(`Failed to list comments: ${s.status}`)}return await s.json()}async function St(e,t,r,n,i){let s=`https://api.github.com/repos/${e}/${t}/issues/${r}/comments`,o=await V(s,i,{method:"POST",body:JSON.stringify({body:n})});if(!o.ok){if(o.status===403||o.status===404)return a.warn(`Insufficient permissions to create comment (status ${o.status}).`),!1;throw new Error(`Failed to create comment: ${o.status}`)}return!0}async function xt(e,t,r,n,i){let s=`https://api.github.com/repos/${e}/${t}/issues/comments/${r}`,o=await V(s,i,{method:"PATCH",body:JSON.stringify({body:n})});if(!o.ok){if(o.status===403||o.status===404)return a.warn(`Insufficient permissions to update comment (status ${o.status}).`),!1;throw new Error(`Failed to update comment: ${o.status}`)}return!0}async function V(e,t,r={}){let n=new Headers(r.headers??{});return n.set("Authorization",`Bearer ${t}`),n.set("Accept","application/vnd.github+json"),n.set("User-Agent","base-lint-cli"),fetch(e,{...r,headers:n})}var Le=g(require("path"),1);async function De(e){let t=process.cwd(),r=Le.default.resolve(t,e.input),n=await A(r),i=process.env.GITHUB_TOKEN||process.env.GH_TOKEN,s=process.env.GITHUB_REPOSITORY,o=process.env.GITHUB_EVENT_NAME??"",l=process.env.GITHUB_SHA;if(!i||!s||!l){a.info("GitHub context not detected. Skipping annotations.");return}if(o.startsWith("pull_request")&&(await Tt())?.isFork){a.info("Pull request originates from a fork. Skipping annotations.");return}let c=vt(n.findings,n.meta.treatNewlyAs),u=Math.max(1,Number(e.batchSize??"50")),p=`Limited: ${n.summary.limited} \xB7 Newly: ${n.summary.newly} \xB7 Widely: ${n.summary.widely}`,m=Et(n),[f,w]=s.split("/"),d="Base Lint",y=new Date().toISOString(),W={title:d,summary:p,text:"Generated by base-lint."},Je=c.slice(0,u),h=await Oe(`https://api.github.com/repos/${f}/${w}/check-runs`,i,{method:"POST",body:JSON.stringify({name:d,head_sha:l,status:"completed",conclusion:m,completed_at:y,output:{...W,annotations:Je}})});if(!h.ok){if(h.status===403||h.status===404){a.warn(`Insufficient permissions to create check run (status ${h.status}).`);return}throw new Error(`Failed to create check run: ${h.status}`)}let K=(await h.json()).id;if(!K){a.warn("Check run created without id. Skipping additional annotations.");return}let _=c.slice(u);if(_.length===0)return;let Y=[];for(let b=0;b<_.length;b+=u)Y.push(_.slice(b,b+u));for(let b of Y){let X=await Oe(`https://api.github.com/repos/${f}/${w}/check-runs/${K}`,i,{method:"PATCH",body:JSON.stringify({status:"completed",conclusion:m,completed_at:new Date().toISOString(),output:{...W,annotations:b}})});if(!X.ok){a.warn(`Failed to append annotations (status ${X.status}).`);break}}}function vt(e,t){let r=[];for(let n of e){if(n.baseline==="widely")continue;let i=At(n.baseline,t),s=n.line??1,o=n.column??void 0;r.push({path:n.file,start_line:s,end_line:s,start_column:o,end_column:o,annotation_level:i,title:n.featureName,message:`${n.featureName} is ${n.baseline}. ${n.guidance}`})}return r}function At(e,t){return e==="limited"||t==="error"?"failure":t==="ignore"?"notice":"warning"}function Et(e){return e.summary.limited>0||e.meta.treatNewlyAs==="error"&&e.summary.newly>0?"failure":e.summary.newly>0?"neutral":"success"}async function Tt(){let e=process.env.GITHUB_EVENT_PATH;if(!e)return null;try{let t=await A(e),r=t?.pull_request?.base?.repo?.full_name,n=t?.pull_request?.head?.repo?.full_name;return{isFork:!!(n&&r&&n!==r)}}catch(t){return a.warn(`Failed to read event payload: ${t.message}`),null}}async function Oe(e,t,r={}){let n=new Headers(r.headers??{});return n.set("Authorization",`Bearer ${t}`),n.set("Accept","application/vnd.github+json"),n.set("User-Agent","base-lint-cli"),fetch(e,{...r,headers:n})}var je={name:"base-lint",version:"0.1.0",description:"Lint your repo against Web Baseline policies",license:"MIT",type:"module",bin:{"base-lint":"./dist/index.js"},files:["dist"],imports:{vitest:"../../tests/mocks/vitest.js"},scripts:{build:"tsup --config tsup.config.ts",dev:"tsx src/index.ts --help",prepublishOnly:"npm run build"},dependencies:{"@typescript-eslint/typescript-estree":"^6.21.0",commander:"^11.1.0",globby:"^13.2.2",ignore:"^5.3.1",minimatch:"^9.0.3","node-html-parser":"^6.1.11",picocolors:"^1.0.0",postcss:"^8.4.35","web-features":"^2.0.0"},devDependencies:{"@types/node":"^20.11.30",tsup:"^8.0.1",tsx:"^4.7.1",typescript:"^5.4.2"}};var x=new He.Command;x.name("base-lint").description("Baseline-aware linting for modern web platform features").version(je.version??"0.0.0");x.command("scan").description("Scan files for Baseline coverage issues").option("--mode <mode>","analysis mode: diff or repo","diff").option("--out <dir>","output directory for reports",".base-lint-report").option("--strict","enable strict feature detection").option("--treat-newly <behavior>","treat Newly features as warn|error|ignore","warn").option("--config <path>","path to config file override").action(async e=>{try{await Fe(e)}catch(t){E(t)}});x.command("enforce").description("Enforce policy against a previously generated JSON report").requiredOption("--input <file>","path to JSON report").option("--max-limited <count>","maximum number of limited findings","0").option("--fail-on-warn","treat Newly findings as failures").action(async e=>{try{await Ce(e)}catch(t){E(t)}});x.command("comment").description("Create or update a sticky pull request summary comment on GitHub").requiredOption("--input <file>","Markdown report to post").option("--sticky-marker <marker>","HTML comment marker for sticky comment","<!-- base-lint-sticky -->").action(async e=>{try{await Be(e)}catch(t){E(t)}});x.command("annotate").description("Publish GitHub Checks annotations for findings").requiredOption("--input <file>","JSON report to annotate from").option("--batch-size <n>","number of annotations per API request","50").action(async e=>{try{await De(e)}catch(t){E(t)}});x.parseAsync().catch(e=>{E(e)});function E(e){let t=e instanceof Error?e.message:String(e);console.error(t),process.exitCode=1}
